TODO
=======================

MVP
-----------------
Have units firing
Have a separate formation to fight
units killable

add some hystersis to xflip of musket

slerp taking ages to do 180, figure out a constant turn rate and do it that way instead

To think about
-----------------
verticality. 
    How to represent?
        terrain, units crouching, prone
    
    Mechanics?
        collision masks

FormationUI
-----------------
resizeablility
scrollability, for when it gets too big
have separate field for unit facing
have import\export

Need to prevent clicks on UI from affecting gamescene
    Having gamescene only "active" when instructed from the UI is a very clunky way to do it. Need to figure out how to have UI interactives suppress events flowing through to GS (this may just be default Heaps behaviour, need to test by having units be interactives)

    see discord screengrab, have a dummy interactive layer under the UI. Still kinda hacky

Issues
    UI min width\height will never decrease. Once an element pushes the max it will stay that way.
        Extra UI to shrink down? Kinda a PITA, UI for UI's sake
        Need to have more dynamic inputWidth for TextInputs, destination in particular gets hidden quickly
    Reticle interactive being pixel perfect is annoying. Ditto Rotation. "concave" interactives in general.
    Will need an option to invert middle mouse movement direction. Probably lots of others. To revisit when we're serialising everything.

    I've commented out the following
    https://github.com/HeapsIO/heaps/blob/master/h2d/Scene.hx#L528-L529
    if( ex < 0 || ey < 0 || ex >= width || ey >= height )
        return null;
    it's intention seems to be to prevent checking against interactives that aren't in the viewport, but I must be misunderstanding something because very clearly it's preventing me from interacting with units that are on screen.
        verified that this is a problem with my particular setup, somehow. Need to do a fresh install, perhaps

Direct Formation Control
-----------------
Have a direct mouse based way to change row\column parameters?

Need to have a more clever assignment of units to positions. Pathfinding\distance based

Notes on optimisation
-----------------
Make a big list of normal values and work through them instead of numerical\marsaglia method

Might be worth having a go at porting box2d v3.

Notes on dynamics
-----------------
If a unit is too disordered (far from where it's meant to be in formation), it should lose track of where it's meant to be. Especially if morale is impacted.
Enough disordered units near each other should break from formation completely. Enough of these together, and not under threat, may be able to reform.

Need to calculate the maximum turn rate for a formation of a given width and units of given top speed. Or, y'know, just let the player figure it out.

How to reorder units naturally? Feels like rows should fill from the back, and units removed from columns should form new rows at the back.

Have "macros" for manuevers, where you keyframe several configurations together, activatable as abilities
    goal: design countermarch and caracole this way

Two rank fire:
    have first rank kneel, not sure how to show this visually
Three rank fire:
    have first kneel, third step to the side. Need to have some limit to this, five maybe? Maybe not, the further out you step the longer it takes. And balance it somehow, make it expensive in "drilling" points or something. Also morale loss from being "out of order". How to generalise? the further away from the "standard" formation the more expensive it is? Number of steps in the "macro"?

    Each "line" be a separate formation then?

Have a formation's destination be another formation, friendly or enemy.
    have formations break into sub-formations? I.e counter march by having front row break into sub formation, then move back through the original formation, rejoining it.
    Similarly with forming square.

Completed
=======================
MVP
-----------------
Have units moving about in formation
Be able to dynamically change formation

FormationUI
-----------------
make whole UI draggable
    need to prevent it from being dragged off-screen
make the layout pretty (kinda)
Automatically have minimum width\height for all flows be equal to the largest, to preserve the grid layout
have holding down mouse repeat button activation
add buttons for destination and facing
make the data text directly editable

GameScene
-----------------
middle mouse scroll, infinite zoom, edge scrolling
    Middle mouse scroll is always from centre. Would be nice to do it from the mouse position, but I'd need to override camera's linalg ops and I'm lazy

Issues
-----------------
InputText doesn't delete the last character correctly (still a bit buggy with Vector2D inputs)

Direct Formation Control
-----------------
make an interactive, have it control positioning and facing. Have a ghost to indicate future positioning
    add a small timer before setting ChoosingFacing in FormationGraphics, to prevent unintended facing changes 